# AGENTS.md - Instructions for AI Agents

Welcome, AI Agent! This file provides guidance for working with the `Odum Energy Language` repository.

## 1. Project Overview

This is a template repository for building modern web applications using Web Components with TypeScript and Vite. It features a client-side router and is set up for easy deployment to GitHub Pages. The goal is to create a diagramming tool for the Odum Energy Systems Language.

## 2. Key Technologies

*   **TypeScript:** For static typing and modern JavaScript features.
*   **Vite:** For fast development and optimized builds.
*   **Web Components:** For creating reusable custom elements.
*   **Client-Side Routing:** Custom router implemented in `src/core/router/router.ts`.
*   **CSS Variables:** For themeable and maintainable styles.
*   **ESLint & Prettier:** For code linting and formatting (configurations are in `eslint.config.js` and `.prettierrc.cjs`).


### 2.1. Technology Constraints

**This project MUST be built using only native browser technologies. Adherence to this constraint is mandatory.**

*   **Allowed:**
    *   TypeScript
    *   Native Web Components (Custom Elements, Shadow DOM, HTML Templates)
    *   Native JavaScript (ES6+ modules)
    *   SVG for all graphics and symbols
    *   Vite for the build tooling
    *   Vitest for testing

*   **Forbidden:**
    *   **No 3rd-party UI frameworks or libraries.** This includes, but is not limited to, React, Vue, Angular, Svelte, Lit, Stencil, etc.
    *   **No 3rd-party component libraries.** All UI components must be built from scratch as native Web Components.
    *   **No 3rd-party drawing/canvas libraries.** All diagramming functionality must be implemented directly using SVG and native browser APIs.

The purpose of this project is to explore the capabilities of the modern web platform without abstractions. Any additions to the dependency list in `package.json` must be for development purposes only (e.g., linters, bundlers, test runners) and must not be part of the final application bundle.


## 3. Directory Structure

*   `src/`: Contains all source code.
    *   `src/components/`: Houses individual web components, typically one directory per component (e.g., `home-page/`, `nav-page/`).
    *   `src/core/`: Core application logic.
        *   `src/core/base-component.ts`: A base class that components can extend.
        *   `src/core/router/`: Client-side routing implementation.
    *   `src/main.ts`: The main entry point of the application, initializes the router and registers routes.
    *   `src/styles/`: Global styles and CSS variables.
*   `dist/`: The build output directory (generated by `npm run build`). This directory is deployed to GitHub Pages.
*   `.github/workflows/`: Contains GitHub Actions workflows, including `deploy.yml` for GitHub Pages deployment.
*   `index.html`: The main HTML entry point for the application (source file).
*   `vite.config.ts`: Vite build and development server configuration.

## 4. Development Workflow

### üö® NON-NEGOTIABLE PRE-COMMIT REQUIREMENTS üö®

The following commands MUST be run and MUST pass before pushing any commit to GitHub. This is mandatory and cannot be skipped or modified:

1. **Install Dependencies:** `npm ci`
2. **Run Type Check:** `npm run type-check`
3. **Run Lint:** `npm run lint`
4. **Run Tests:** `npm test` (uses Vitest)

**ALL of these must complete successfully with zero errors before any git push.**

### Build Command

The build is done during deployment:
*   **Build for Production:** `npm run build` (output goes to `dist/`)

### End-to-End Testing

In addition to the Vitest unit tests, this project uses Playwright for end-to-end (E2E) testing. E2E tests simulate real user interactions in a browser, ensuring that the application as a whole works as expected.

*   **Running E2E Tests:** To run the Playwright test suite, use the following command:
    ```bash
    npm run test:e2e
    ```
*   **When to Run:** While not part of the mandatory pre-commit checks (to keep the local development loop fast), it is highly recommended to run the E2E tests before submitting a pull request to catch any potential integration issues.
*   **CI/CD:** The E2E tests are automatically run in the CI pipeline for all pull requests to `main`.

### Git Workflow & Project Management

#### üö® MANDATORY GIT WORKFLOW üö®

**For Every New Task:**

1. **Sync with Main Branch:**
   ```bash
   git checkout main
   git fetch origin
   git pull origin main
   ```

2. **Create Feature Branch:**
   ```bash
   git checkout -b feature/ISSUE-NUMBER-brief-description
   # Example: git checkout -b feature/123-add-user-profile-component
   ```

3. **Branch Naming Convention:**
   - `feature/ISSUE-NUMBER-brief-description` - For new features
   - `bugfix/ISSUE-NUMBER-brief-description` - For bug fixes
   - `hotfix/ISSUE-NUMBER-brief-description` - For urgent production fixes
   - `docs/ISSUE-NUMBER-brief-description` - For documentation updates
   - `refactor/ISSUE-NUMBER-brief-description` - For code refactoring

4. **Development Cycle:**
   - Make your changes on the feature branch
   - **BEFORE COMMITTING:** Run all NON-NEGOTIABLE requirements
   - Commit with meaningful messages (see Commit Message Standards below)
   - Push feature branch: `git push origin feature/ISSUE-NUMBER-brief-description`

5. **Pull Request Process:**
   - Create PR from feature branch to main
   - Wait for PR approval before proceeding to next task
   - **Do NOT merge your own PRs**
   - After approval, update TODO item status to "done"

6. **Post-Merge Cleanup:**
   - Return to main: `git checkout main`
   - Pull latest: `git pull origin main`
   - Delete local feature branch: `git branch -d feature/ISSUE-NUMBER-brief-description`

#### Commit Message Standards

**Format:**
```
type(scope): brief description

Longer explanation if needed

- List specific changes
- Include any breaking changes
- Reference issue numbers

Closes #ISSUE-NUMBER
```

**Types:**
- `feat:` - New feature
- `fix:` - Bug fix
- `docs:` - Documentation changes
- `style:` - Formatting changes (no code logic changes)
- `refactor:` - Code refactoring
- `test:` - Adding or updating tests
- `chore:` - Maintenance tasks, dependency updates

**Examples:**
```bash
git commit -m "feat(components): add user profile component

- Add UserProfile web component with shadow DOM
- Include responsive CSS styling
- Add unit tests for component rendering
- Integrate with existing router system

Closes #123"

git commit -m "fix(router): resolve navigation issue on page refresh

- Fix base URL handling in router.ts
- Update route matching logic for deep links
- Add error handling for invalid routes

Closes #456"

git commit -m "docs(readme): update installation instructions

- Add Node.js version requirements
- Include troubleshooting section
- Fix broken links in documentation

Closes #789"
```

#### Emergency Procedures

**If You Need to Switch Tasks Mid-Development:**
```bash
# Stash current work
git stash push -m "WIP: describe current work"

# Switch to main and create new branch for urgent task
git checkout main
git pull origin main
git checkout -b hotfix/URGENT-ISSUE-NUMBER-description

# After urgent work is complete, return to previous work
git checkout feature/ORIGINAL-ISSUE-NUMBER-description
git stash pop
```

**If Main Branch Has Updates While You're Working:**
```bash
# From your feature branch
git checkout main
git pull origin main
git checkout feature/YOUR-BRANCH-NAME
git rebase main
# Resolve any conflicts, then continue
```

## 5. Deployment (GitHub Pages)

This project is configured for deployment to GitHub Pages under a repository-named subdirectory (e.g., `https://<username>.github.io/odum-energy-language/`).

*   **Base Path:** The `vite.config.ts` file sets `base: '/odum-energy-language/'` during production builds (`command === 'build'`). This ensures that `import.meta.env.BASE_URL` is correctly set to `/odum-energy-language/`, and all asset paths in the built `index.html` are prefixed accordingly.
*   **SPA Routing (404.html Strategy):** To support deep linking in the SPA on GitHub Pages, the `.github/workflows/deploy.yml` workflow includes a step: `cp dist/index.html dist/404.html`. This means GitHub Pages will serve the application's main `index.html` file for any path it doesn't directly recognize, allowing the client-side router to handle the specific route.

## 6. Routing

*   Client-side routing is handled by the `Router` class in `src/core/router/router.ts`.
*   Routes are defined and registered in `src/main.ts` using `Router.getInstance().registerRoute({...});`.
*   The router uses `import.meta.env.BASE_URL` (provided by Vite, see "Deployment" section) to correctly determine the application-specific path from `window.location.pathname`. For example, if `BASE_URL` is `/odum-energy-language/` and `window.location.pathname` is `/odum-energy-language/about`, the router will correctly identify the application path as `/about`.

## 7. Component Structure

*   Components are typically located in their own subdirectory within `src/components/`.
*   A component usually consists of:
    *   A `.ts` file for the component logic (e.g., `my-component.ts`).
    *   An `.html` file for the component's template.
    *   A `.css` file for the component's styles.
    *   A `.test.ts` file for unit tests.
*   Many components extend the `BaseComponent` class from `src/core/base-component.ts`, which provides a simple way to attach a shadow DOM and apply HTML/CSS templates.

## 8. Coding Style & Conventions

*   Follow existing code style and maintain consistency.
*   Code is formatted using Prettier and linted using ESLint. Ensure changes pass these checks.
*   Use kebab-case for custom element tag names (e.g., `app-root`, `home-page`).
*   Write meaningful commit messages that describe the change and its purpose.

## 9. Gemini Agent Instructions

If you are a Gemini agent, please consult the `gemini.md` file for a detailed workflow on how to add new features to this project. The instructions in `gemini.md` are designed to work in conjunction with the rules outlined in this document.

## 10. SELF-UPDATE PROTOCOL FOR AI AGENTS

### When to Propose AGENTS.md Updates

You MUST propose an update to this AGENTS.md file when you encounter any of the following scenarios:

#### Build/Test/Deployment Issues
- **Persistent Errors:** Recurring build, lint, or test errors across multiple interactions
- **Missing Documentation:** Errors that could be prevented with better documentation
- **Dependency Conflicts:** Package installation or version conflicts requiring workarounds
- **Configuration Issues:** Problems with ESLint, Prettier, TypeScript, or Vite configurations
- **CI/CD Problems:** GitHub Actions workflow failures or deployment issues

#### Git Workflow & Process Improvements
- **Development Inefficiencies:** Patterns that slow down the development cycle
- **Missing Best Practices:** Better approaches to common development tasks
- **Tool Integration Problems:** Development tools not working optimally together
- **Testing Gaps:** Areas where testing could be improved or streamlined
- **Git Workflow Issues:** Problems with the PR/commit process, branching strategies, or merge conflicts
- **Branch Management:** Issues with branch naming, cleanup, or synchronization

#### Documentation & Knowledge Management
- **Outdated Information:** Sections that have become obsolete or incorrect
- **Missing Context:** Important project details not adequately documented
- **Unclear Instructions:** Ambiguous or incomplete guidance
- **New Patterns:** Emerging coding patterns or architectural decisions
- **Knowledge Gaps:** Information that would benefit future AI agents

#### DevSecOps & Security Concerns
- **Security Vulnerabilities:** Instructions that could introduce security risks
- **Insecure Practices:** Documented workflows with security implications
- **Dependency Security:** Package installations or configurations posing threats
- **Build/Deploy Security:** CI/CD processes creating potential attack vectors
- **Well-Intentioned Security Issues:** Changes made with good intentions that compromise security
- **Missing Security Guidelines:** Absence of security best practices in workflows

### How to Propose Updates

When proposing a self-update to AGENTS.md, use this structured format:

```
## PROPOSED AGENTS.MD UPDATE

### Reason for Update:
[Clearly describe the issue, pattern, or improvement that prompted this update]

### Section(s) to Modify:
[Specify which sections need changes - be specific with section numbers/names]

### Proposed Changes:
[Provide the exact text changes, additions, or removals needed]

### Security Impact Assessment (if applicable):
[For security-related updates: assess impact and provide mitigation strategies]

### Expected Benefits:
[Explain how this change will improve AI agent workflow, prevent issues, or enhance security]

### Testing/Validation:
[If applicable, describe how the proposed changes can be validated]
```

### Update Guidelines

#### ‚úÖ ALLOWED UPDATES:
- Adding troubleshooting sections for common errors
- Clarifying existing instructions and removing ambiguity
- Documenting new patterns and best practices discovered
- Updating tool versions or commands (with security review)
- Adding performance optimization tips
- Expanding component structure guidelines
- Adding debugging strategies and techniques
- **Security Enhancements:** Adding or updating security best practices
- **Vulnerability Remediation:** Removing or modifying risky instructions
- **DevSecOps Integration:** Embedding security into development workflows
- **Process Improvements:** Streamlining workflows based on learned patterns

#### ‚ùå FORBIDDEN UPDATES:
- Modifying the NON-NEGOTIABLE PRE-COMMIT REQUIREMENTS
- Changing the mandatory pre-commit workflow (install, type-check, lint, test)
- **Altering the MANDATORY GIT WORKFLOW** without explicit approval
- Altering core project architecture without explicit approval
- Removing essential sections or safety guardrails
- Changing deployment configuration without authorization
- **Security Regression:** Any changes that weaken existing security measures
- **Security Bypass:** Instructions that circumvent security tools or processes
- **Workflow Shortcuts:** Removing quality gates or safety checks
- **Git Safety Bypasses:** Instructions to skip branch creation, PR process, or merge protections

### Self-Improvement Mindset

As an AI agent working with this codebase, embody these principles:

**Learning & Pattern Recognition:**
- Track recurring errors and their solutions
- Identify inefficiencies in development workflows
- Document successful problem-solving approaches

**Proactive Problem-Solving:**
- Anticipate issues that future AI agents might encounter
- Think beyond immediate fixes to systematic improvements
- Consider the long-term maintainability of solutions

**Quality & Security First:**
- Maintain high code quality standards in all contributions
- Always evaluate security implications of proposed changes
- Integrate DevSecOps thinking into all development practices
- Question whether past "helpful" additions might have unintended consequences

**Continuous Improvement:**
- Seek opportunities to enhance both the application and the development process
- Balance innovation with stability and reliability
- Share knowledge through clear documentation and examples

**Collaboration & Communication:**
- Write clear, actionable update proposals
- Provide context and justification for all suggested changes
- Consider the impact on other developers and future AI agents

---

**Remember:** The goal is continuous improvement while maintaining stability, security, and reliability. Every change should make the development experience better for future AI agents and human developers.

## PROPOSED AGENTS.MD UPDATE

### Reason for Update:
The project name and repository name have been consolidated to `odum-energy-language`. The documentation previously contained outdated references to `boba`, which was causing confusion and was inconsistent with `vite.config.ts` and `package.json`.

### Section(s) to Modify:
- Section 5: Deployment (GitHub Pages)
- Section 6: Routing

### Proposed Changes:
Replaced all instances of `boba` with `odum-energy-language` in the examples for deployment paths and routing base URLs. This aligns the documentation with the actual project configuration.

### Security Impact Assessment (if applicable):
N/A. This is a documentation consistency update.

### Expected Benefits:
Instructions are now consistent with the rest of the codebase and the live deployment configuration, reducing confusion for AI agents and developers.

### Testing/Validation:
The changes can be validated by confirming that the instructions in this document now align with the `base` property in `vite.config.ts` and the `homepage` URL in `package.json`.
